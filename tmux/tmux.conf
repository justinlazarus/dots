# =========================================
# Terminal Settings
# =========================================
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# =========================================
# Prefix Key Configuration
# =========================================
# Change prefix from default Ctrl-b to Ctrl-Space
unbind C-b
set-option -g prefix C-Space
bind-key C-Space send-prefix

# =========================================
# Key Bindings
# =========================================
# Copy mode (vim mode)
bind [ copy-mode

# Copy mode vim-style selection and yanking
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle

# Paste from system clipboard
bind P paste-buffer

# Window splitting
bind | split-window -h
bind - split-window -v

# Reload config file
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded!"

# Kill pane/window without confirmation
bind x kill-pane
bind X kill-window

# Pane navigation (vim-style)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane resizing (vim-style with repeatable keys)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# =========================================
# Window & Pane Settings
# =========================================
# Enable vi mode keys
setw -g mode-keys vi

# Enable mouse support
set -g mouse on

# Start window and pane numbering at 1 instead of 0
set -g base-index 1
setw -g pane-base-index 1

# Automatically renumber windows when one is deleted
set-option -g renumber-windows on

# Don't exit tmux when closing a session
set -g detach-on-destroy off

# =========================================
# Tokyo Night Storm Theme
# =========================================
# Color definitions
%hidden tokyo_night_bg='#24283b'
%hidden tokyo_night_fg='#c0caf5'
%hidden tokyo_night_blue='#7aa2f7'
%hidden tokyo_night_purple='#bb9af7'
%hidden tokyo_night_green='#9ece6a'
%hidden tokyo_night_yellow='#e0af68'
%hidden tokyo_night_red='#f7768e'
%hidden tokyo_night_cyan='#7dcfff'
%hidden tokyo_night_dark='#1d202f'
%hidden tokyo_night_gray='#414868'

# Status bar
set -g status-style "bg=$tokyo_night_bg,fg=$tokyo_night_fg"
set -g status-interval 2
set -g status-position bottom

# Window status
set -g window-status-style "bg=$tokyo_night_bg,fg=$tokyo_night_gray"
set -g window-status-current-style "bg=$tokyo_night_blue,fg=$tokyo_night_bg,bold"
set -g window-status-format " #I:#W "
set -g window-status-current-format " #I:#W "

# Pane borders
set -g pane-border-style "fg=$tokyo_night_gray"
set -g pane-active-border-style "fg=$tokyo_night_blue"

# Message style
set -g message-style "bg=$tokyo_night_blue,fg=$tokyo_night_bg"
set -g message-command-style "bg=$tokyo_night_purple,fg=$tokyo_night_bg"

# Copy mode highlighting
set -g mode-style "bg=$tokyo_night_blue,fg=$tokyo_night_bg"

# Left side of status bar
set -g status-left "#[bg=$tokyo_night_purple,fg=$tokyo_night_bg,bold] #S #[bg=$tokyo_night_bg,fg=$tokyo_night_purple]"
set -g status-left-length 100

# Right side of status bar (git info via gitmux, fallback to basic info if not available)
set -g status-right "#[fg=$tokyo_night_green]#(gitmux -cfg $HOME/.config/tmux/.gitmuxconfig \"#{pane_current_path}\" 2>/dev/null || echo \"\") #[fg=$tokyo_night_blue]#[bg=$tokyo_night_blue,fg=$tokyo_night_bg] %Y-%m-%d #[fg=$tokyo_night_purple]#[bg=$tokyo_night_purple,fg=$tokyo_night_bg] %H:%M "
set -g status-right-length 100

# =========================================
# Plugin Configuration
# =========================================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'

# Initialize TMUX plugin manager (keep this line at the very bottom)
run '~/.tmux/plugins/tpm/tpm'
